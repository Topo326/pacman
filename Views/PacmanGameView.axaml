<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:PacmanGame.ViewModels"
             x:Class="PacmanGame.Views.PacmanGameView"
             x:DataType="vm:PacmanGameViewModel">
  
  <Design.DataContext>
    <vm:PacmanGameViewModel/>
  </Design.DataContext>

  <Grid RowDefinitions="Auto,*" Background="Black">
    
    <Border Grid.Row="0" Background="#1a1a2e" Padding="15" BorderBrush="#16213e" BorderThickness="0,0,0,2">
      <Grid ColumnDefinitions="*,Auto,*">
        
        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="15">
          <Border Background="#0f3460" CornerRadius="8" Padding="12,6" BorderBrush="#16213e" BorderThickness="2">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <TextBlock Text="ðŸ† SCORE:" Foreground="#eaf4fc" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
              <TextBlock Text="{Binding Score}" Foreground="#FFD700" FontSize="18" FontWeight="Bold" VerticalAlignment="Center" MinWidth="80"/>
            </StackPanel>
          </Border>
          
          <Border Background="#0f3460" CornerRadius="8" Padding="12,6" BorderBrush="#16213e" BorderThickness="2">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <TextBlock Text="â¤ï¸ VIDAS:" Foreground="#eaf4fc" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
              <TextBlock Text="{Binding Lives}" Foreground="#FF4757" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
            </StackPanel>
          </Border>
        </StackPanel>

        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center">
          <Button Content="â–¶ INICIAR" Command="{Binding StartGameCommand}" 
                  Background="#2ECC40" Foreground="White" Padding="20,8" 
                  FontWeight="Bold" CornerRadius="6" FontSize="14"
                  Cursor="Hand">
            <Button.Styles>
              <Style Selector="Button:pointerover">
                <Setter Property="Background" Value="#27A535"/>
              </Style>
            </Button.Styles>
          </Button>
          <Button Content="â¸ PAUSAR" Command="{Binding StopGameCommand}" 
                  Background="#FF4136" Foreground="White" Padding="20,8" 
                  FontWeight="Bold" CornerRadius="6" FontSize="14"
                  Cursor="Hand">
            <Button.Styles>
              <Style Selector="Button:pointerover">
                <Setter Property="Background" Value="#E6362C"/>
              </Style>
            </Button.Styles>
          </Button>
        </StackPanel>
        
      </Grid>
    </Border>

    <Border Grid.Row="1" 
            Background="#0a0a0a"
            HorizontalAlignment="Center" 
            VerticalAlignment="Center"
            Padding="30">
      
      <Border BorderBrush="#1e3a8a" 
              BorderThickness="4" 
              CornerRadius="8"
              Background="Black">
        <Border.Effect>
          <DropShadowEffect Color="#3b82f6" BlurRadius="20" Opacity="0.5"/>
        </Border.Effect>
        
        <Canvas Width="{Binding CanvasWidth}" 
                Height="{Binding CanvasHeight}" 
                Background="Black"
                KeyDown="Canvas_KeyDown"
                Focusable="True"
                Name="GameCanvas"
                Loaded="Canvas_Loaded">
          
          <!-- Mapa renderizado directamente -->
          <ItemsControl ItemsSource="{Binding MapTiles}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <Canvas/>
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Grid Canvas.Left="{Binding X}" Canvas.Top="{Binding Y}">
                  <!-- Pared (tipo 1) -->
                  <Rectangle Width="20" Height="20" Fill="#342DCA" IsVisible="{Binding Type, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=1}"/>
                  
                  <!-- Comida (tipo 2) -->
                  <Ellipse Width="6" Height="6" Fill="#FEB897" Margin="7" IsVisible="{Binding Type, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=2}"/>
                </Grid>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
          
          <!-- Fantasmas -->
          <ItemsControl ItemsSource="{Binding Ghosts}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <Canvas/>
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Ellipse Width="18" Height="18"
                         Fill="{Binding Color}"
                         Canvas.Left="{Binding X}"
                         Canvas.Top="{Binding Y}">
                  <Ellipse.Effect>
                    <DropShadowEffect Color="{Binding Color}" BlurRadius="8" Opacity="0.6"/>
                  </Ellipse.Effect>
                </Ellipse>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
          
          <!-- Pac-Man -->
          <Ellipse Width="{Binding Pacman.Width}" 
                   Height="{Binding Pacman.Height}"
                   Fill="#FFFF00"
                   Canvas.Left="{Binding Pacman.X}"
                   Canvas.Top="{Binding Pacman.Y}"
                   IsVisible="{Binding Pacman, Converter={x:Static ObjectConverters.IsNotNull}}">
            <Ellipse.Effect>
              <DropShadowEffect Color="#FFD700" BlurRadius="10" Opacity="0.8"/>
            </Ellipse.Effect>
          </Ellipse>
                   
        </Canvas>
      </Border>
    </Border>
    
  </Grid>
</UserControl>
